### 绪论

- 计算机网络的概念：一些互联的、自治的计算机系统的集合
- IOS/OSI参考模型：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
- TCP/IP模型：网络接口层（物理层和数据链路层）、网际层、传输层和应用层（会话层、表示层、应用层）
- IOS模型精确地定义了三个主要概念：服务、协议和接口
- 五层协议体系结构：物理层、数据链路层、网络层、传输层和应用层



### 物理层

- 传输单位：比特

- 物理层数据传输分为3种方式：电路交换、报文交换以及分组交换

  - 电路交换：进行数据传输之前，两节点之间必须建立一条专用（双方独占）的物理通信路径

    - 优点：
      1. 通信时延小，速度快
      2. 有序传输
      3. 没有冲突
    - 缺点：
      1. 建立连接时间长
      2. 线路独占，使用效率低

  - 报文交换：数据交换的单位是报文，在交换结点采用存储转发的传输方式

    - 优点：
      1. 无需建立连接
      2. 动态分配线路
    - 缺点：
      1. 数据进入交换结点后要经历存储、转发这一过程，从而引起转发时延
      2. 报文交换对报文大小没有限制，导致网络结点需要有较大的缓存空间

  - 分组交换：是报文交换的改进方法，把大的数据块划分成小数据块，加上控制信息，构成分组。

    - 优点：
      1. 无建立时延
      2. 简化了存储管理
      3. 加速传输
      4. 减少了出错几率
    - 缺点：
      1. 存在传输时延
      2. 需要传输额外的信息量（控制信息）

    - 分组交换两种方式：数据报、虚电路

      |                    | 数据报服务                                                 | 虚电路服务                                               |
      | :----------------- | :--------------------------------------------------------- | -------------------------------------------------------- |
      | 连接的建立         | 不要                                                       | 必须有                                                   |
      | 目的地址           | 每个分组都有完整的目的地址                                 | 仅在建立连接阶段使用，之后每个分组使用长度较短的虚电路号 |
      | 路由选择           | 每个分组独立地进行路由选择和转发                           | 属于同一条虚电路的分组按照同一路由转发                   |
      | 分组顺序           | 不保证分组的有序到达                                       | 保证分组的有序到达                                       |
      | 可靠性             | 不保证可靠通信，可靠性由用户主机来保证                     | 可靠性由网络保证                                         |
      | 对网络故障的适应性 | 出故障的结点丢失分组，其他分组路径选择发生变化，可正常传输 | 所有经过故障节点的虚电路均不能正常工作                   |
      | 差错处理和流量控制 | 由用户主机进行流量控制，不保证数据报的可靠性               | 可由分组交换网负责，也可由用户主机负责                   |

- 物理层设备：中继器、集线器



### 数据链路层（点到点，主机与主机）

- 传输单位：帧

- 功能：数据链路层在物理层提供服务的基础上向网络层提供服务，起主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上**无差错**的数据链路，使之对网络层表现为一条**无差错的链路**。

  - 成帧、**差错控制**、流量控制、可靠传输机制、介质访问控制

    - 成帧：将一段数据的前后分别添加首部和尾部，就构成了帧。

    - 差错控制：分为位错和帧错

      - 位错指的是帧中的某些位出现了差错（循环冗余校验CRC、海明码 ）
      - 帧错指的是帧的丢失、重复或失序等错误（帧编号机制、计时器超时重发）

    - 流量控制：限制**发送方**的数据流量（滑动窗口）

    - 可靠传输机制：**确认**和**超时重发**

    - 介质访问控制：采取一定措施是的两对结点之间的通信不会发生互相干扰的情况

      - 信道划分介质访问控制（静态）：结点之间的通信，要么共享时间，要么共享空间，要么两者都共享

      - 介质随机访问控制协议（动态）：ALOHA协议、CSMA协议、CSMA/CD协议、CSMA/CA协议
        - 核心思想：胜利者通过争用获得信道，从而获得信息的发送权。

- 数据链路层通常可为网络层提供的服务有：
  - 无确认的无连接服务（以太网）

  - 有确认的无连接服务（无线通信）

  - 有确认的面向连接服务（适用于通信要求较高的场合）

- 广域网：通常跨接很大的物理范围，能连接多个城市或者国家。形成国际性的远程网络。实现资源共享。
  - 主要使用分组交换技术。Internet是世界范围内最大的广域网。

  - 协议： PPP协议、HDLC协议

 - 局域网（LAN）：是指在某一区域由多台计算机互联成的计算机组，使用广播信道。
   1. 覆盖的地理范围范围小，旨在一个相对独立的局部范围内联，如一座或者集中的建筑群内。
   2. 使用专门铺设的传输介质（双绞线，同轴电缆）进行联网，数据传输率高（10Mb/s-10Gb/s）
   3. 通信延迟时间短，误码率低，可靠性高
   4. 各站为平等关系，共享传输通道
   5. 多采用分布式控制和广播式通信，能进行广播和组播。
   
- 局域网拓扑结构：星形结构、环形结构、总线型结构、星形和总线形结合的复合型结构

- 局域网的机制访问控制方法：CSMA/CD、令牌总线和令牌环

- IEEE 802标准定义的局域网参考模型只对应于OSI参考模型的数据链路层和物理层

- 局域网分类：
  1. 以太网：以太网是应用最为广泛的局域网。逻辑拓扑是总线型结构，物理拓扑是星型或者拓展星型结构。采用IEEE802.3标准，使用CSMA/CD技术。提供无连接不可靠的服务。
  2. 令牌环网：明日黄花，基本不用
  3. FDDI网
  4. ATM网
  5. 无线局域网：采用IEEE802.11
  
- 数据链路层设备：网桥、交换机

  

### 网络层（主机之间的逻辑通信）

- 传输单位：数据报
- 功能：异构网络互联、路由与转发、拥塞控制（开环、闭环）
  - 流量控制、拥塞控制、差错控制、网际互联
  - 路由选择与分组转发：前者根据特定的路由协议构造路由表，后者处理通过路由器的数据流，关键操作是转发表的查询、转发以及相关的队列管理和任务调度等。
  - 拥塞控制：主要解决的问题是如何获取网络中发生拥塞的信息，从而利用这些信息进行控制，以避免由于拥塞而出现分组的丢失以及严重拥塞而产生网络死锁的现象。
    - 开环控制：事先将有关发生拥塞的因素考虑周到，静态预防方法。
    - 闭环控制：是先不考虑有关发生拥塞的各种因素，采用检测网络系统去监视、检测，属于动态方法
- IPv4报文格式
  - IP地址由网络号和主机号构成，32比特（4字节）
    - A类：0：网络号8比特（1~126）
    - B类：10：网络号16比特（128.1~191.255）
    - C类：110：网络号24比特（192.0.1~223.255.255）
  - 主机号全为0表示本网络本身，主机号全为1表示本网络的广播地址
- NAT：将专用网络地址转换为公用地址
- 子网划分与子网掩码、CIDR：解决IP地址利用率问题（例如主机数很多，但用的很少）
- ARP协议、DHCP协议、ICMP协议
  - ARP协议：对于特定的IP地址，查询其对应的物理地址
  - DHCP协议：给网络中的主机动态的分配IP地址
  - ICMP协议：用来给主机或路由器报告差错和异常情况
- 网络层设备：路由器



### 传输层（端到端，进程之间的逻辑通信）

- 传输单位：报文段（TCP）或用户数据报（UDP）

- 提供的服务：进程之间的逻辑通信、复用和分用、差错检测、面向连接的TCP和无连接的UDP

- 功能：流量控制、差错控制、服务质量、数据传输管理

- 传输层介于通信子网（物理层、链路层、网络层）和资源子网（会话层、表示层、应用层）之间

- 传输层向高层用户屏蔽了底层网络核心的细节（如网络拓扑、路由协议等）

- 套接字（socket）= 主机IP地址 + 端口号

- 常用端口号：

  | 端口 |           服务           |
  | :--: | :----------------------: |
  |  21  |   FTP（文件传输协议）    |
  |  22  |           SSH            |
  |  23  |  Telnet（远程登陆）服务  |
  |  25  | SMTP（简单邮件传输协议） |
  |  53  |      DNS域名服务器       |
  |  80  |    HTTP超文本传输协议    |
  | 443  |          HTTPS           |

- 面向连接服务：TCP（transmission control protocol）传输控制协议

  - 特点：有连接、一对一、提供可靠交付、全双工通信、面向字节流

  - 可靠传输机制、流量控制、拥塞控制
    - 可靠传输机制：校验、序号、确认、重传
    - 流量控制：基于滑动窗口协议的流量控制机制
    - 拥塞控制：慢开始、拥塞避免、快重传、快恢复
  - TCP主要特点
    1. TCP是面向连接的传输层协议。
    2. 每一条TCP连接只能有两个端口，每一条TCP 的连接只能是点对点的。
    3. TCP提供可靠交付的服务，无差错、不丢失、不重复、按序到达。
    4. TCP提供全双工通信。（发送缓存，接收缓存）
    5. TCP面向字节流。（TCP把应用程序交下来的数据看成仅仅是一连串的无结构字节流）
  - 应用：文件传输协议FTP、超文本传输协议HTTP、远程登陆TELNET

- 无连接服务：UDP（User datagram protocol）用户数据报协议

  - 相较于IP的数据报服务上提供了两个基本的服务：**复用和分用**以及**差错检测**

  - 特点：无连接、首部开销小、速度快、不可靠

  - UDP主要特点：
    1. UDP是无连接的，减少开销和发送数据之前的延时。
    2. UDP是最大努力交付，即不不保证可靠交付。
    3. UDP是面向报文的，适合一次性传输少量的网络应用。
    4. UDP无拥塞控制，适合很多实时应用。
    5. UDP首部开销小，8B TCP20B。
  - 应用：小文件传送协议（TFTP）、DNS、SNMP、实时协议（RTP）、IP电话、实时视频会议、流媒体

- TCP三次握手、四次分手（主动发起连接建立的应用进程叫客户机，被动等待连接建立的应用进程叫服务器）

  - 三次握手（连接建立）：

  ​       SYN = 1, seq = x

  ​	   SYN = 1, ACK = 1, seq = y, ack = x + 1

  ​	   ACK = 1, seq = x + 1, ack = y + 1

  - 四次分手（连接释放）：

    FIN = 1, seq = x

    ACK = 1, seq = y, ack = x + 1

    FIN = 1, ACK = 1, seq = w, ack = x + 1

    ACK = 1, seq = x + 1, ack = w + 1

- 传输层设备：网关



### 会话层

不同主机上各进程之间的会话，主要是向表示层实体或用户进程提供建立连接并在连接上有序地传输数据



### 表示层

处理两个通信系统中交换信息的表示方式

数据压缩、加密、解密



### 应用层

- 网络应用模型：
  - C/S模型：区分处理请求的服务器和发出请求的客户机
  - P2P模型：每台机器既是服务器又是客户机
- DNS域名系统
  - 作用：把主机名转换为IP地址
  - 协议与端口：运行在UDP之上，使用53号端口
  - 域名解析过程（共使用8个UDP报文）：
    1. 客户机向其本地域名服务器发出DNS请求报文
    2. 本地域名服务器收到请求后，查询本地缓存，假设没有该记录，则以DNS客户的身份向根域名服务器发出解析请求
    3. 根域名服务器收到请求后，判断该域名属于.com域，将对应的顶级域名服务器dns.com的IP地址返回给本地域名服务器
    4. 本地域名服务器向顶级域名服务器dns.com发出解析请求报文。
- 文件传输协议FTP
  - 作用：允许用户在因特网上存取文件
  - 协议与端口：运行在TCP上，控制连接为21号端口，数据链接为20号端口
- 电子邮件
  - STMP
    - 作用：向邮件服务器主动发送电子邮件
    - 协议与端口：运行在TCP之上，使用25号端口
  - POP3
    - 作用：向邮件服务器要求接受电子邮件
    - 协议与端口：运行在TCP之上，使用110号端口
- 超文本传输协议HTTP
  - 作用：在万维网上能够可靠地交换文件
  - 协议与端口：运行在TCP之上，使用80号端口